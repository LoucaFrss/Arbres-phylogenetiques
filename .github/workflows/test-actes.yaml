# .github/workflows/test-actes.yml

name: Tests des Actes Cumulatifs

on:
  push:
    branches: [ "*" ] 
  pull_request:
    branches: [ "master" ] # Cible la branche master
  workflow_dispatch: 

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    # D√©finition des variables de la branche courante
    env:
      # github.ref_name donne le nom de la branche sans 'refs/heads/' (ex: 'acte1', 'master')
      BRANCH_NAME: ${{ github.ref_name }} 
      
      # Logique cumulative : Vrai si la branche contient le nom de l'acte ou un acte sup√©rieur
      # Note : 'master' est toujours inclus
      
      # Acte 1 ou plus
      IS_A1_OR_ABOVE: ${{ contains(env.BRANCH_NAME, 'acte1') || contains(env.BRANCH_NAME, 'acte2') || contains(env.BRANCH_NAME, 'acte3') || contains(env.BRANCH_NAME, 'acte3b') || contains(env.BRANCH_NAME, 'acte4') || env.BRANCH_NAME == 'master' }}
      
      # Acte 2 ou plus
      IS_A2_OR_ABOVE: ${{ contains(env.BRANCH_NAME, 'acte2') || contains(env.BRANCH_NAME, 'acte3') || contains(env.BRANCH_NAME, 'acte3b') || contains(env.BRANCH_NAME, 'acte4') || env.BRANCH_NAME == 'master' }}

      # Acte 3 ou plus
      IS_A3_OR_ABOVE: ${{ contains(env.BRANCH_NAME, 'acte3') || contains(env.BRANCH_NAME, 'acte3b') || contains(env.BRANCH_NAME, 'acte4') || env.BRANCH_NAME == 'master' }}
      
      # Acte 3B ou plus
      IS_A3B_OR_ABOVE: ${{ contains(env.BRANCH_NAME, 'acte3b') || contains(env.BRANCH_NAME, 'acte4') || env.BRANCH_NAME == 'master' }}
      
      # Acte 4 ou plus
      IS_A4_OR_ABOVE: ${{ contains(env.BRANCH_NAME, 'acte4') || env.BRANCH_NAME == 'master' }}
      

    steps:
    - uses: actions/checkout@v4

    # Compilation
    - name: üõ†Ô∏è Compilation (Clang)
      run: make CC=clang

    # üß™ Tests cumulatifs
    
    - name: üî¨ Test Acte 1
      if: ${{ env.IS_A1_OR_ABOVE == 'true' }}
      run: make tests_acte1 CC=clang

    - name: üî¨ Test Acte 2
      if: ${{ env.IS_A2_OR_ABOVE == 'true' }}
      run: make tests_acte2 CC=clang

    - name: üî¨ Test Acte 3
      if: ${{ env.IS_A3_OR_ABOVE == 'true' }}
      run: make tests_acte3 CC=clang

    - name: üî¨ Test Acte 3B
      if: ${{ env.IS_A3B_OR_ABOVE == 'true' }}
      run: make tests_acte3b CC=clang
      
    - name: üî¨ Test Acte 4
      if: ${{ env.IS_A4_OR_ABOVE == 'true' }}
      run: make tests_acte4 CC=clang